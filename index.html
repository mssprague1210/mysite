<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Matthew Sprague – Home</title>
  <meta name="description" content="Digital platforms strategist focused on human-centered design and outdoor-inspired simplicity." />
  <meta name="theme-color" content="#234F2E" />
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="stylesheet" href="/assets/site.css?v=10" />

  <!-- Perf: optional if you remove @import in CSS later -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&family=Figtree:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Skip link for keyboard/screen-reader users -->
  <a class="skip-link" href="#main">Skip to content</a>
  <nav class="top-nav" aria-label="Primary">
    <div class="container">
      <a class="brand" href="/">
        <img src="/favicon.png" alt="M.S. favicon" />
        <span class="name">Matthew Sprague</span>
      </a>

      <div class="menu">
        <a aria-current="page" class="active" href="/">Home</a>
        <a href="/resume/">Resume</a>
        <a href="/hobbies/">Hobbies</a>
        <a href="/trips/">Trips</a>
        <a href="/story/">DND Campaign</a>
      </div>

      <button
        class="hamburger"
        aria-label="Menu"
        aria-controls="mobile-panel"
        aria-expanded="false">
        <span class="bars" aria-hidden="true"></span>
      </button>
    </div>
  </nav>

  <!-- Mobile nav is its own landmark and outside the sticky nav -->
  <nav id="mobile-panel" class="mobile-panel" aria-label="Mobile navigation">
    <a href="/">Home</a>
    <a href="/resume/">Resume</a>
    <a href="/hobbies/">Hobbies</a>
    <a href="/trips/">Trips</a>
    <a href="/story/">DND Campaign</a>
  </nav>

  <main id="main">
    <header id="home" class="hero">
      <div class="container">
        <div class="eyebrow">Digital Platforms • UX • Outdoors</div>
        <h1>Hi, I’m Matthew — I design and lead digital experiences that feel simple and human.</h1>
        <p>I’m a digital platforms strategist with a love for user-centered design and data-informed experimentation. This space will expand with recent projects, writing, and ways I bring an outdoor mindset to digital work.</p>
        <div class="cta-row">
          <a class="button" href="/resume/">View Resume</a>
          <a class="button alt" href="/hobbies/">See Hobbies</a>
        </div>
      </div>
    </header>

    <!-- Weather Widget Section -->
    <section id="gear-forecast" class="container">
        <!-- Initial prompt, visible by default -->
        <div id="widget-prompt" class="widget-prompt">
            <h2>Gear Forecaster</h2>
            <p>Check the weather by you to get recommendations on great gear!</p>
            <button id="forecast-button" class="button">Gear Forecast</button>
        </div>

        <!-- Weather card, hidden by default -->
        <div id="widget-card" class="widget-card" style="display: none;">
            <div id="weather-forecast-display" class="weather-forecast-display">
                <div id="weather-icon"></div>
                <div id="weather-details" class="weather-details">
                    <p id="weather-location">Fetching your location...</p>
                    <p id="weather-temp-desc"></p>
                    <p id="weather-timestamp"></p>
                </div>
            </div>
            <p id="recommendation-text">Finding the right gear for you...</p>
            <div id="recommendation-products" class="recommendation-products">
                <!-- Product image and link will be injected here by JS -->
            </div>
        </div>
    </section>

  </main>

  <footer class="container">
    <p>© <span id="year"></span> Matthew Sprague. Forest green & gold. Hosted on Cloudflare; Netlify deploys.</p>
  </footer>

  <script>
    // --- Standard Page Scripts ---
    document.getElementById('year').textContent = new Date().getFullYear();

    const btn = document.querySelector('.hamburger');
    const panel = document.getElementById('mobile-panel');
    const focusableElements = panel ? panel.querySelectorAll('a') : [];
    const firstLink = focusableElements[0];
    const lastLink = focusableElements[focusableElements.length - 1];

    function openMenu() {
      btn.setAttribute('aria-expanded', 'true');
      document.body.classList.add('mobile-open');
      panel.addEventListener('keydown', trapFocus);
      firstLink && firstLink.focus();
    }
    function closeMenu() {
      btn.setAttribute('aria-expanded', 'false');
      document.body.classList.remove('mobile-open');
      panel.removeEventListener('keydown', trapFocus);
      btn.focus();
    }
    function trapFocus(e) {
      if (e.key === 'Tab') {
        if (e.shiftKey && document.activeElement === firstLink) {
          e.preventDefault();
          lastLink.focus();
        } else if (!e.shiftKey && document.activeElement === lastLink) {
          e.preventDefault();
          firstLink.focus();
        }
      }
    }
    if (btn && panel) {
      btn.addEventListener('click', () => {
        const open = btn.getAttribute('aria-expanded') === 'true';
        open ? closeMenu() : openMenu();
      });
      panel.addEventListener('click', (e) => {
        if (e.target.tagName === 'A') closeMenu();
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && btn.getAttribute('aria-expanded') === 'true') {
          closeMenu();
        }
      });
    }

    // --- Weather Widget Script ---
    const forecastButton = document.getElementById('forecast-button');
    const widgetPrompt = document.getElementById('widget-prompt');
    const widgetCard = document.getElementById('widget-card');

    const weatherWidget = () => {
        const weatherIconEl = document.getElementById('weather-icon');
        const locationEl = document.getElementById('weather-location');
        const tempDescEl = document.getElementById('weather-temp-desc');
        const timestampEl = document.getElementById('weather-timestamp');
        const recommendationTextEl = document.getElementById('recommendation-text');
        const recommendationProductsEl = document.getElementById('recommendation-products');

        const recommendations = {
            hot: { text: "Wow! It's hot out there. If you're running or cycling today, staying hydrated is key.", product: { name: "Hydration Packs", link: "https://www.rei.com/c/hydration-packs", image: "hydration-pack.webp" }},
            rain: { text: "Don't let the rain stop you! A good waterproof jacket makes all the difference for training in the wet.", product: { name: "Rain Jackets", link: "https://www.outdoorresearch.com/collections/mens-rain-jackets", image: "rain-jacket.webp" }},
            cold: { text: "It's chilly! Layering up is the best way to stay warm on your adventures. Check out these versatile base layers.", product: { name: "Base Layers", link: "https://www.rei.com/c/mens-base-layer-tops", image: "base-layer.webp" }},
            snow: { text: "Looks like snow! Perfect weather for some warm, waterproof boots to keep your feet happy.", product: { name: "Winter Boots", link: "https://www.rei.com/c/mens-winter-boots", image: "winter-boots.webp" }},
            clear: { text: "It's a beautiful clear day! Perfect for getting outside. Protect your eyes with a quality pair of sunglasses.", product: { name: "Sunglasses", link: "https://www.rei.com/c/sunglasses", image: "sunglasses.webp" }},
            default: { text: "Whatever the weather, having the right gear makes every adventure better. Explore the latest outdoor equipment.", product: { name: "New Arrivals", link: "https://www.rei.com/c/new-arrivals", image: "new-arrivals.webp" }}
        };

        const getWeatherData = async (lat, lon) => {
            try {
                const response = await fetch(`/.netlify/functions/weather?lat=${lat}&lon=${lon}`);
                if (!response.ok) throw new Error('Weather data not available.');
                const data = await response.json();
                updateWidget(data);
            } catch (error) {
                locationEl.textContent = 'Could not fetch weather.';
                console.error(error);
            }
        };

        const updateWidget = (data) => {
            const temp = Math.round(data.main.temp);
            const description = data.weather[0].description;
            const iconCode = data.weather[0].icon;
            const weatherId = data.weather[0].id;
            const timestamp = new Date(data.dt * 1000);
            const hour = timestamp.getHours();
            const formattedTime = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            // Set day/night class for icon background based on daylight hours
            if (hour >= 6 && hour < 18) { // 6 AM to 6 PM is considered "day"
                weatherIconEl.classList.add('is-day');
                weatherIconEl.classList.remove('is-night');
            } else {
                weatherIconEl.classList.add('is-night');
                weatherIconEl.classList.remove('is-day');
            }

            locationEl.textContent = `Your forecast in ${data.name}`;
            tempDescEl.textContent = `${temp}°F, ${description}`;
            timestampEl.textContent = `Updated at ${formattedTime}`;
            weatherIconEl.innerHTML = `<img src="https://openweathermap.org/img/wn/${iconCode}@2x.png" alt="${description}">`;

            let recommendation;
            if (temp > 85) recommendation = recommendations.hot;
            else if (weatherId >= 200 && weatherId < 600) recommendation = recommendations.rain;
            else if (weatherId >= 600 && weatherId < 700) recommendation = recommendations.snow;
            else if (temp < 40) recommendation = recommendations.cold;
            else if (weatherId === 800) recommendation = recommendations.clear;
            else recommendation = recommendations.default;
            
            recommendationTextEl.textContent = recommendation.text;
            
            const product = recommendation.product;
            recommendationProductsEl.innerHTML = `
                <div class="product-item">
                    <img src="/gear-forecast/${product.image}" alt="${product.name}" width="120" height="120">
                    <a href="${product.link}" class="button" target="_blank" rel="noopener noreferrer">${product.name}</a>
                </div>
            `;
        };

        const getLocation = () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => { getWeatherData(position.coords.latitude, position.coords.longitude); },
                    (error) => {
                        locationEl.textContent = 'Location access denied.';
                        recommendationTextEl.textContent = 'Please enable location services to get a gear forecast.';
                        console.error(error);
                    }
                );
            } else {
                locationEl.textContent = 'Geolocation is not supported.';
                recommendationTextEl.textContent = 'Sorry, your browser does not support the features needed for a forecast.';
            }
        };

        getLocation();
    };

    forecastButton.addEventListener('click', () => {
        widgetPrompt.style.display = 'none';
        widgetCard.style.display = 'flex';
        weatherWidget();
    });

  </script>
</body>
</html>
